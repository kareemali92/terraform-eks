#!/bin/bash -xe

CA_CERTIFICATE_DIRECTORY=/etc/kubernetes/pki
CA_CERTIFICATE_FILE_PATH=/ca.crt
mkdir -p 
echo "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5RENDQWJDZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJd01Ea3lOREV3TVRZME5Wb1hEVE13TURreU1qRXdNVFkwTlZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTk1WCklNSjd3UDFvZUhHdXVEMC80S0JkWk1jRml0Rk5yd1VrV2QvT0hIUzdHK3ppMVhIU2NGTVNEclNxUmVnRFBYWUgKYTg5OG1SbnNSV0FMUjA5SDdwZUN1Qng4Zmp5S29Id3hSSmMxS1MxSmJaTHo2azlVNHhwdkpuYUlFYzQreVoxdgpzV2hDNFNyeVBqcFpMVVFza01zaGJlM3lzaTJLdXdUR2xlRzA4eGx0SWVKeGRqZ2g5dHlyWnFLME80ODRIRUFnCkhxMWZNRnU1Qlc2Q2d1NlRjSjhzUkhmWkppTmR1YzYrbGdjZzZOZ08xUW1uYVdMZ1ErcitIRTFxZmQwRUlNZHcKenNoVzYwY3ZEMWw2NEF6Z3d4cUQ4a2p1VzBDaHR2RVpFakJ5T3RtTmZUWUhwLzBlWGxZSk1wV0llRGZsUEtWQwphU3VENjNlVVVVZlVqSHpMMjMwQ0F3RUFBYU1qTUNFd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFLVlRhVG9MdnJDS21BNnlITWlEZ3djbHBxRk0KdVNRYmRNYlhIUTU4YVd4OXVyWnk1NUs0a1RHLzM3dDNEcDNVMlY1Ty8wUGZxSmY5dnJVaVFOUG4yZEVxeGNZSgpIODBQR3JZUkpETUxhblArNWFJY1d4YkFoWE5HRS9Lb0pEWEYvUVMxOUFRcTJLTVBqSnFaVE0zN3p5d1lFeVV5CkZ4bk9oWEtDVXFaWWx0RzZwNC9YU29EVVRrYWVCK3JZODV4aVBsWVpMTjFJbGQ1VXdMNlFuaFdSL3RvN1AwT2EKWnZGNlFXZ0d3Y3k3ZCtHUVd3NTI1ZjVEd08xRmQxaXZqdy83RlpYaHRUMEtabXcxSnBlbWhuRjliZVlqK3pacgpKWEZCM1ZuNml4YkQxd2RFZzE2ajlLMDNNTDc3MGRkRzlwdUZuZERrY0F1bzZWa3Myb0VmTG5XdVhXST0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=" | base64 -d >  
INTERNAL_IP=
sed -i s,MASTER_ENDPOINT,https://6FB9A109AAF86FDF8D5BD3504971C80B.gr7.eu-west-1.eks.amazonaws.com,g /var/lib/kubelet/kubeconfig
sed -i s,CLUSTER_NAME,terraform-test-eks-DfDp78VA,g /var/lib/kubelet/kubeconfig
sed -i s,REGION,eu-west-1,g /etc/systemd/system/kubelet.service
sed -i s,MAX_PODS,20,g /etc/systemd/system/kubelet.service
sed -i s,MASTER_ENDPOINT,https://6FB9A109AAF86FDF8D5BD3504971C80B.gr7.eu-west-1.eks.amazonaws.com,g /etc/systemd/system/kubelet.service
sed -i s,INTERNAL_IP,,g /etc/systemd/system/kubelet.service
DNS_CLUSTER_IP=10.100.0.10
if [[  == 10.* ]] ; then DNS_CLUSTER_IP=172.20.0.10; fi
sed -i s,DNS_CLUSTER_IP,,g /etc/systemd/system/kubelet.service
sed -i s,CERTIFICATE_AUTHORITY_FILE,,g /var/lib/kubelet/kubeconfig
sed -i s,CLIENT_CA_FILE,,g  /etc/systemd/system/kubelet.service
systemctl daemon-reload
systemctl restart kubelet
